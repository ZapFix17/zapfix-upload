<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZapFix - Watch Video</title>
<style>
  body { font-family: 'Poppins', sans-serif; background: #E0F3FF; margin: 0; padding: 0; color: #333; }
  header { display: flex; align-items: center; justify-content: space-between; background: #fff; padding: 15px 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 10; }
  .logo { font-size: 26px; font-weight: 700; color: #0077ff; cursor: pointer; }
  .nav-right { display: flex; align-items: center; gap: 15px; }
  .upload-btn { background: #0077ff; color: white; border: none; padding: 10px 18px; border-radius: 10px; cursor: pointer; font-size: 15px; transition: background 0.2s ease; }
  .upload-btn:hover { background: #005cd1; }
  .search-bar { display: flex; align-items: center; background: #f2f4f8; padding: 6px 10px; border-radius: 8px; gap: 8px; }
  .search-bar i { color: #0077ff; }
  .search-bar input { border: none; background: transparent; outline: none; font-size: 14px; width: 180px; }
  main { display: grid; grid-template-columns: 2fr 1fr; gap: 25px; padding: 30px; }
  .video-section { background: white; border-radius: 16px; padding: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
  video { width: 100%; border-radius: 12px; background: #000; max-height: 480px; }
  .video-title { font-size: 20px; font-weight: 600; color: #222; margin-top: 10px; }
  .video-actions { margin-top: 12px; display: flex; align-items: center; gap: 10px; }
  #likeBtn { background: #0077ff; color: white; border: none; padding: 8px 14px; border-radius: 8px; cursor: pointer; font-size: 15px; transition: background 0.2s ease; }
  #likeBtn:hover { background: #005cd1; }
  #likeCount { font-weight: 600; color: #333; }
  .comment-section { margin-top: 25px; background: #E7F3FF; padding: 15px; border-radius: 12px; }
  .comment-section h3 { color: #0077ff; margin-bottom: 10px; }
  .comment-box { display: flex; flex-direction: column; gap: 8px; }
  .comment-box input, .comment-box textarea { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; font-size: 14px; outline: none; }
  .comment-box button { background: #0077ff; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; width: 100px; align-self: flex-end; transition: background 0.2s; }
  .comment-box button:hover { background: #005cd1; }
  .comments-list { margin-top: 15px; }
  .comment { background: white; border-radius: 8px; padding: 8px 10px; margin-top: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.05); }
  .next-section { background: white; border-radius: 16px; padding: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); height: fit-content; max-height: calc(100vh - 120px); overflow-y: auto; }
  .next-title { font-weight: 600; color: #0077ff; margin-bottom: 12px; text-align: center; }
  .next-video { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; cursor: pointer; }
  .next-video img { width: 100px; height: 60px; border-radius: 8px; object-fit: cover; }
  .next-video span { font-size: 14px; font-weight: 500; }
  @media (max-width: 900px) { main { grid-template-columns: 1fr; } .next-section { max-height: unset; } }
</style>
</head>
<body>

<header>
  <div class="logo" onclick="window.location.href='feed.html'">ZAPFIX</div>
  <div class="nav-right">
    <div class="search-bar">
      <i>üîç</i>
      <input type="text" id="searchInput" placeholder="Search videos...">
    </div>
    <button class="upload-btn" onclick="window.location.href='upload.html'">Upload Video</button>
  </div>
</header>

<main>
  <section class="video-section">
    <video id="videoPlayer" controls></video>
    <div class="video-title" id="videoTitle">Video Title</div>
    <div class="video-actions">
      <button id="likeBtn">üëç Like</button>
      <span id="likeCount">0</span>
    </div>

    <div class="comment-section">
      <h3>Comments</h3>
      <div class="comment-box">
        <input type="text" id="userName" placeholder="Your name">
        <textarea id="userComment" placeholder="Add a comment..." rows="3"></textarea>
        <button id="postComment">Post</button>
      </div>
      <div class="comments-list" id="commentsList"></div>
    </div>
  </section>

  <aside class="next-section">
    <div class="next-title">Next Video Suggestions</div>
    <div id="nextVideos"></div>
  </aside>
</main>

<script>
(async function() {
  const backendURL = "https://zapfix-backend-d5cd.onrender.com"; // change to your hosting URL later
  const videoPlayer = document.getElementById('videoPlayer');
  const videoTitle = document.getElementById('videoTitle');
  const nextVideosContainer = document.getElementById('nextVideos');
  const likeBtn = document.getElementById('likeBtn');
  const likeCount = document.getElementById('likeCount');
  const nameInput = document.getElementById('userName');
  const commentInput = document.getElementById('userComment');
  const postBtn = document.getElementById('postComment');
  const commentsList = document.getElementById('commentsList');

  let selectedVideo = JSON.parse(localStorage.getItem('selectedVideo') || '{}');
  let allVideos = [];

  try {
    const res = await fetch(`${backendURL}/videos`);
    const data = await res.json();
    if (data.success) allVideos = data.videos;
  } catch (err) {
    console.error("Backend connection failed:", err);
  }

  if (selectedVideo && selectedVideo.video) {
    videoPlayer.src = selectedVideo.video;
    videoTitle.textContent = selectedVideo.title;
  } else {
    videoTitle.textContent = "No video selected.";
  }

  // LIKE system
  const likeKey = `likes_${selectedVideo.title || 'none'}`;
  let likes = parseInt(localStorage.getItem(likeKey) || '0');
  likeCount.textContent = likes;
  likeBtn.addEventListener('click', () => {
    likes++;
    likeCount.textContent = likes;
    localStorage.setItem(likeKey, likes);
  });

  // COMMENTS system
  const commentKey = `comments_${selectedVideo.title || 'none'}`;
  let comments = JSON.parse(localStorage.getItem(commentKey) || '[]');
  function renderComments() {
    commentsList.innerHTML = '';
    comments.forEach(c => {
      const div = document.createElement('div');
      div.className = 'comment';
      div.innerHTML = `<strong>${c.name}</strong><p>${c.text}</p>`;
      commentsList.appendChild(div);
    });
  }
  renderComments();

  postBtn.addEventListener('click', () => {
    const name = nameInput.value.trim();
    const text = commentInput.value.trim();
    if (!name || !text) return alert('Enter name and comment');
    comments.push({ name, text });
    localStorage.setItem(commentKey, JSON.stringify(comments));
    renderComments();
    nameInput.value = '';
    commentInput.value = '';
  });

  // NEXT videos
  const nextVideos = allVideos.filter(v => v.title !== selectedVideo.title);
  nextVideosContainer.innerHTML = '';
  nextVideos.forEach(v => {
    const div = document.createElement('div');
    div.className = 'next-video';
    div.innerHTML = `<img src="${v.thumbnail}" alt="thumb"><span>${v.title}</span>`;
    div.addEventListener('click', () => {
      localStorage.setItem('selectedVideo', JSON.stringify(v));
      window.location.reload();
    });
    nextVideosContainer.appendChild(div);
  });

  // SEARCH filter for next videos
  const searchInput = document.getElementById('searchInput');
  searchInput.addEventListener('input', () => {
    const query = searchInput.value.toLowerCase();
    nextVideosContainer.innerHTML = '';
    nextVideos
      .filter(v => v.title.toLowerCase().includes(query))
      .forEach(v => {
        const div = document.createElement('div');
        div.className = 'next-video';
        div.innerHTML = `<img src="${v.thumbnail}" alt="thumb"><span>${v.title}</span>`;
        div.addEventListener('click', () => {
          localStorage.setItem('selectedVideo', JSON.stringify(v));
          window.location.reload();
        });
        nextVideosContainer.appendChild(div);
      });
  });
})();
</script>
</body>
</html>


