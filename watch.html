<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZapFix - Watch Video</title>
<style>
  body { font-family: 'Poppins', sans-serif; background: #E0F3FF; margin: 0; padding: 0; color: #333; }
  header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 25px;
    background: #fff;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    position: sticky;
    top: 0;
    z-index: 10;
  }
  .logo { font-size: 26px; font-weight: 700; color: #0077ff; cursor: pointer; }
  .nav-right { display: flex; gap: 10px; align-items: center; }
  .search-bar { display: flex; align-items: center; background: #f2f4f8; padding: 6px 10px; border-radius: 8px; gap: 8px; }
  .search-bar i { color: #0077ff; }
  .search-bar input { border: none; background: transparent; outline: none; font-size: 14px; width: 160px; }
  .btn { padding: 8px 14px; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; }
  .btn-upload { background: #0077ff; color: white; }
  .btn-upload:hover { background: #005cd1; }
  .btn-share { background: #00b894; color: white; }
  .btn-share:hover { background: #01996b; }

  main { display: grid; grid-template-columns: 2fr 1fr; gap: 25px; padding: 30px; }
  .video-section { background: white; border-radius: 16px; padding: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
  video { width: 100%; border-radius: 12px; background: #000; max-height: 480px; }
  .video-title { font-size: 20px; font-weight: 600; color: #222; margin-top: 10px; }
  .video-actions { display: flex; justify-content: space-between; align-items: center; margin-top: 12px; flex-wrap: wrap; }
  #likeBtn { background: #0077ff; color: white; }
  #likeBtn:hover { background: #005cd1; }
  #likeCount { margin-left: 6px; font-weight: 600; color: #fff; }
  .comment-section { margin-top: 25px; background: #E7F3FF; padding: 15px; border-radius: 12px; }
  .comment-section h3 { color: #0077ff; margin-bottom: 10px; }
  .comment-box { display: flex; flex-direction: column; gap: 8px; }
  .comment-box input, .comment-box textarea { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; font-size: 14px; outline: none; }
  .comment-box button { background: #0077ff; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; width: 100px; align-self: flex-end; transition: background 0.2s; }
  .comment-box button:hover { background: #005cd1; }
  .comments-list { margin-top: 15px; }
  .comment { background: white; border-radius: 8px; padding: 8px 10px; margin-top: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.05); }

  .next-section { background: white; border-radius: 16px; padding: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); max-height: calc(100vh - 120px); overflow-y: auto; }
  .next-title { font-weight: 600; color: #0077ff; margin-bottom: 12px; text-align: center; }
  .next-video { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; cursor: pointer; }
  .next-video img { width: 100px; height: 60px; border-radius: 8px; object-fit: cover; }
  .next-video span { font-size: 14px; font-weight: 500; }

  @media (max-width: 900px) { main { grid-template-columns: 1fr; } .next-section { max-height: unset; } }
</style>
</head>
<body>

<header>
  <div class="logo" onclick="window.location.href='feed.html'">ZAPFIX</div>
  <div class="nav-right">
    <div class="search-bar">
      <i>üîç</i>
      <input type="text" id="searchInput" placeholder="Search videos...">
    </div>
    <button class="btn btn-upload" id="uploadBtn" onclick="window.location.href='upload.html'">üü¶ Upload Video</button>
  </div>
</header>

<main>
  <section class="video-section">
    <video id="videoPlayer" controls></video>
    <div class="video-title" id="videoTitle">Video Title</div>

    <div class="video-actions">
      <button id="likeBtn" class="btn">üëç Like <span id="likeCount">0</span></button>
      <button class="btn btn-share" id="shareBtn"> Share</button>
    </div>

    <div class="comment-section">
      <h3>Comments</h3>
      <div class="comment-box">
        <input type="text" id="userName" placeholder="Your name">
        <textarea id="userComment" placeholder="Add a comment..." rows="3"></textarea>
        <button id="postComment">Post</button>
      </div>
      <div class="comments-list" id="commentsList"></div>
    </div>
  </section>

  <aside class="next-section">
    <div class="next-title">Next Video Suggestions</div>
    <div id="nextVideos"></div>
  </aside>
</main>

<script>
(async function() {
  const videoPlayer = document.getElementById('videoPlayer');
  const videoTitle = document.getElementById('videoTitle');
  const nextVideosContainer = document.getElementById('nextVideos');

  const likeBtn = document.getElementById('likeBtn');
  const likeCount = document.getElementById('likeCount');
  const shareBtn = document.getElementById('shareBtn');
  const nameInput = document.getElementById('userName');
  const commentInput = document.getElementById('userComment');
  const postBtn = document.getElementById('postComment');
  const commentsList = document.getElementById('commentsList');

  // Line 104: CHANGE backend URL here
  const backendURL = 'https://zapfix-backend-f8km.onrender.com';

  let selectedVideo = JSON.parse(localStorage.getItem('selectedVideo') || '{}');

  // FETCH all videos from backend
  let allVideos = [];
  try {
    const res = await fetch(backendURL);
    const data = await res.json();
    allVideos = Array.isArray(data) ? data : (data.success && Array.isArray(data.videos) ? data.videos : []);
  } catch(err){ console.error('Failed to fetch videos', err); }

  // Render selected video
  if(selectedVideo && selectedVideo.video){
    videoPlayer.src = selectedVideo.video;
    videoTitle.textContent = selectedVideo.title;
  }

  // LIKE button
  const likeKey = `likes_${selectedVideo.title || 'none'}`;
  let likes = parseInt(localStorage.getItem(likeKey) || '0');
  likeCount.textContent = likes;
  likeBtn.addEventListener('click', () => {
    likes++; 
    likeCount.textContent = likes;
    localStorage.setItem(likeKey, likes);
  });

  // SHARE button
  shareBtn.addEventListener('click', () => {
    if(navigator.share){
      navigator.share({ title: selectedVideo.title, url: window.location.href });
    } else {
      prompt('Copy this link to share:', window.location.href);
    }
  });

  // COMMENTS
  const commentKey = `comments_${selectedVideo.title || 'none'}`;
  let comments = JSON.parse(localStorage.getItem(commentKey) || '[]');
  function renderComments(){
    commentsList.innerHTML = '';
    comments.forEach(c=>{
      const div = document.createElement('div');
      div.className='comment';
      div.innerHTML=`<strong>${c.name}</strong><p>${c.text}</p>`;
      commentsList.appendChild(div);
    });
  }
  renderComments();
  postBtn.addEventListener('click', ()=>{
    const name = nameInput.value.trim();
    const text = commentInput.value.trim();
    if(!name || !text) return alert('Enter name and comment');
    comments.push({name,text});
    localStorage.setItem(commentKey, JSON.stringify(comments));
    renderComments();
    nameInput.value=''; commentInput.value='';
  });

  // NEXT video suggestions
  function renderNext(query=''){
    nextVideosContainer.innerHTML='';
    allVideos.filter(v => v.title !== selectedVideo.title && v.title.toLowerCase().includes(query.toLowerCase()))
      .forEach(v=>{
        const div=document.createElement('div');
        div.className='next-video';
        div.innerHTML=`<img src="${v.thumbnail}" alt="thumb"><span>${v.title}</span>`;
        div.addEventListener('click', ()=>{
          localStorage.setItem('selectedVideo', JSON.stringify(v));
          window.location.reload();
        });
        nextVideosContainer.appendChild(div);
      });
  }
  renderNext();

  document.getElementById('searchInput').addEventListener('input', (e)=>{
    renderNext(e.target.value);
  });
})();
</script>
</body>
</html>

